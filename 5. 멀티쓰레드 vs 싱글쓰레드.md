# 5. MMORPG 서버구조

<pre>
MMORPG 게임의 가장 큰 문제점 : 유저가 많다, 하나의 서버가 처리해야할 작업량이 많다.
서버가 해야할 일  
    1. 패킷 처리(Read/Write)
        -> Acotr수의 비례하여 패킷처리량이 증가한다.
    2. Tick 처리
    3. 그외 System

원활한 패킷처리를 위해서는 멀티쓰레드 처리환경이 필요하다.
-> 멀티쓰레드 처리환경을 구축하기는 생각보다 쉽지않으며, 효율적으로 사용하기위해서는 잘짜여진 구조가 필요하다.

기본적인 싱글쓰레드 구조는 이런 구조로 짜여져 있다.
Network I/O -> Queue -> Work Thread 를 통하여 처리를 많이 하였다.
싱글쓰레드는 멀티쓰레드처럼 많은 작업량을 한꺼번에 처리할 수는 없지만, 
멀티쓰레드에서 발생할 수 있는 데드락과 같은 교착상태가 발생하지 않는다는 장점이 있다.

두번째 조금 발전한 싱글쓰레드 구조로는 Single Thread + a Dedicate Thread
Network I/O + WorkThread + 그 외 DB쓰레드나 특정한 역할을 하는 쓰레드를 추가하는 구조도 있다.
이것은 싱글쓰레드의 단점을 어느정도 보완한다는 장점이 있다.
그래도 멀티쓰레드처럼 많은 작업량을 처리할 수 는 없다.

그 다음 멀티쓰레드 구조는 이렇게 생겼다.
Network I/O + Queue + WorkThread 1 + WorkThread 2 + WorkThread 3 ....
이 구조는 네트워크 I/O에서 Queue로 패킷을 넘기고 여러개의 많은 쓰레드들이 Queue에서
계속 작업량을 가져와 처리하는 방식이다.
장점은 여러개의 쓰레드가 존재하여 작업처리 속도가 굉장히 뛰어나다.
단점은 여러개의 쓰레드가 Queue에서 작업을 가져갈때 Locking을 하기 때문에 그로인해 많은 문제가 발생할 수 있다.

그렇기 때문에 멀티쓰레드의 단점을 줄이기 위해서는 구획화를 해야한다.

정리
1. 싱글 쓰레드 
    장점 : 만들기가 간단하다.
    단점 : 감당할 수 있는 Actor수가 적다.

2. 멀티 쓰레드
    장점 : 감당할 수 있는 Actor수가 많다.
    단점 : 만들기가 어렵고 구조를 잘 짜야한다.

그렇다고 해서 싱글 쓰레드 구조가 무조건 나쁜 구조라고 할 수 있는 것은 아니다.
이러한 싱글 쓰레드의 단점을 보완하기 위해서는 멀티 프로세스 환경이라는 것을 이용할 수 있다.
본인이 개발하려는 게임의 구조에 따라 다르겠지만 하나의 프로세스가 아닌 여러개로 구획화 시킬 수 있는 구조라면
멀티 프로세스로 나누어서 그 안에 싱글 쓰레드로 구조를 구성하여 다중처리의 장점과 싱글쓰레드의 구현의 심플함의 장점을
같이 가져 갈 수도 있다. 

ref: https://youtu.be/yk-HD8YoyZg
</pre>
