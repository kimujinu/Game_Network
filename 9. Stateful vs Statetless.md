# 9. 실시간 게임서버(Stateful) vs 비동기 게임서버(Stateless)

<pre>
실시간 온라인 게임
-> 실시간 온라인 게임의 대표적인 장르는 MMORPG (대규모 멀티온라인 RPG)이다.
   수많은 유저가 같은 공간에서 실시간으로 빠르게 움직이고 전투를 하며 상호작용 하는 게임이다.

-> 실시간 온라인 게임을 구분하는 가장 큰 요소는 다른 유저들의 플레이 화면이 보이는가
   즉각적인 상호작용(이동,전투,행위)가 가능한가 이다.
   물론 이 외에도 MOBA(AOS), FPS 게임, 대전플레이 게임 등 다양한 장르가 존재한다.

-> 이런 실시간 온라인 게임들은 다수의 유저들과 실시간 액션 플레이를 해야한다.
   그렇기 때문에 모든 클라이언트는 서버에 접속하여 연결을 유지한 상태로 플레이를 진행한다.
   또한 게임의 로직과 전투의 판정 등, 모든 데이터와 결정은 게임서버가 주도적으로 진행해야만 한다.

-> 이러한 게임을 '실시간 온라인 게임' 이라고 부르며 이런 목적의 게임 서버를 'Stateful Game Server'라고 부른다.

비동기 (비실시간) 온라인 게임
-> 유저간의 상호작용이 없거나 상호작용이 굉장히 제한적인 게임으로 싱글 게임에 가까운 온라인 게임이다.
   유저간의 실시간 상호작용 컨텐츠가 없이 혼자서 싱글 플레이를 하는 게임에 적합한 기술이다.
   ex) 모바일 싱글 RPG, 온라인 퍼즐게임, 방치형 게임, 수집형 게임, 유저간 실시간 플레이가 없는 대부분의 모바일 게임
   
-> 이런 게임들을 '비동기 (비실시간) 온라인 게임' 이라고 부르며, 이런 목적의 게임서버를 'Stateless Game Server'라고 부른다.
   최근의 온라인 게임의 추세는 비동기 온라인 게임이 활성화되고 있다. 개발의 편의성도 뛰어나고,
   유저들 또한 더 가볍고 손쉬운 게임을 선호하고 있기 때문이다.
   
유저간 상호작용을 하는 비동기 온라인 게임
-> 다른 유저들의 플레이 상황이 보여지거나, 다른 유저의 마을을 공격하거나, 도와주기도 하면 상호작용을 하는것이 아닌가?
   라고 생각할 수 있다.
   하지만, 이것은 모두 완벽한 실시간이 아니며 서버에 저장되어 있는 과거의 데이터를 보여주는 것이다.
          약간의 과거 데이터를 보여주어도 문제가 없는 컨텐츠로 개발되었으며, 그래서 '비동기 게임'이라고 표현하는 것이다.
         
-> 물론 비동기 게임서버(Stateless Server) 기술로도 다른 유저들의 상황이 실시간에 가깝게 보이도록 만들 수 있다.
   하지만, 완벽한 실시간을 보장받기 힘들기 때문에 실시간 상호작용 컨텐츠를 넣기에 어려움이 있으며, 실시간 컨텐츠를 주력으로 하기에는
   Stateless 게임서버의 성능, 기능상의 한계가 존재한다.
   
실시간 게임서버 + 비동기 게임서버
-> 게임의 장르, 플레이 방식에 따라 게임서버의 개발 방식이 다르게 된다.
   최근에는 게임 컨텐츠가 다양화 됨에 따라 위의 2가지(실시간 온라인, 비동기 온라인)방식이 함께 적용되어 가고 있다.

-> ex) 비동기 온라인 게임(Stateless) + 실시간 채팅(Stateful)
       비동기 온라인 게임(Stateless) + 실시간 PVP 인스턴스 던전(Stateful)
       실시간 온라인 게임(Stateful) + 토탈 랭킹 컨텐츠(Stateless)
       실시간 온라인 게임(Stateful) + 로비, 캐릭터 꾸미기(Stateless)
       실시간 온라인 게임(Stateful) + 느슨한 상호작용 컨텐츠(Stateless)
       
* 결국은 어떤 기술이 온라인 게임을 장악하지 못한다. 2가지 기술이 공존하게 되며, 각 용도에 맞는 개발 방법으로 게임 서버는 발전하고 있다.

정리 :

Stateful 게임서버의 장점과 단점
-> 장점 : 연결 유지로 인해 다른 유저들의 행동, 변화를 바로바로 동기화가능
          빠른 처리 속도로 실시간 온라인 게임이 가능
          모든 게임의 로직을 서버가 전담하므로 핵이 불가능하다.

-> 단점 : 개발 자체가 어렵다.
          서버가 다운되면 모든 유저의 게임이 종료되며, 롤백 가능성이 존재한다.
          MMORPG 같은 경우 한 서버당 접속자 제한이 생긴다.(서버군, 채널로 분산가능)
          
Stateless 게임서버의 장점, 단점
-> 장점 : 개발이 훨씬 편리하다.(언어자체의 편의성, 자료, 라이브러리 등이 많다)
          서버의 오류가 발생하여도 일부 유저, 일부 기능에만 문제가 생긴다.
          모든 데이터는 DB 기준으로 처리하기 때문에 서버 다운의 롤백이 없다.
          웹서버의 분산 처리가 용이하다.
 
-> 단점 : 서버와의 실시간 처리는 어려움이 있다.
          일부 게임의 경우 클라이언트 단독 로직으로 인해 핵이 존재할 수 있다.

Stateful과 Stateless의 선택
-> 온라인 게임서버의 2가지 기술이 있지만 선택의 기준은 명확하다.
   게임의 장르에 따라서 결정되어야 하며, 클라이언트의 플랫폼(PC, 모바일)에 따라 결정되는 사항이 아니다.
   MMORPG, MOBA, 스포츠, 액션 등과 같이 다른 유저와 실시간 플레이를 하는 게임이라면 Stateful 서버로 개발되어야 하며,
   이런 요소가 없는 비동기형 온라인 게임이라면 Stateless로 개발되는 것이 맞다.
   
-> 물론 2가지 기술이 모두 사용되는 게임서비스도 굉장히 많다.
   MMORPG 임에도 로그인/로비 서버는 Stateless 서버로, 실제 게임은 Stateful 서버로 만들기도 하며
   모바일 비동기 온라인 게임의 경우도 메인 게임서버는 Stateless 서버로 만들지만 채팅이나 실시간 PVP 컨텐츠
   같이 일부 컨텐츠에 대해서만 Stateful 서버를 만들어서 서비스가 되는 경우도 종종있다.
   
* 두 기술의 좋다 나쁘다가 아닌 적용 대상에 따라 기술을 다르게 사용해야 함을 명심하자.

ref : http://post.procademy.co.kr/archives/624
</pre>
